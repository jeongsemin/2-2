Type.registerNamespace("Common.App.AppsForOfficeCommon");Common.App.AppsForOfficeCommon.B=function(){};Common.App.AppsForOfficeCommon.o=function(){this.Ver=1};Common.App.AppsForOfficeCommon.i=function(n){this.b=n};Common.App.AppsForOfficeCommon.i.prototype={b:null,a:function(n,t,i){var r=new Common.App.AppsForOfficeCommon.o;r.Data=t;r.RR=i;r.CreatedOn=(new Date).getTime();this.b.a(n,Sys.Serialization.JavaScriptSerializer.serialize(r))}};Common.App.AppsForOfficeCommon.o.registerClass("Common.App.AppsForOfficeCommon.o");Type.registerNamespace("Common.App.OAuth");Common.App.OAuth.b=function(){};Common.App.OAuth.b.registerInterface("Common.App.OAuth.b");Common.App.OAuth.m=function(){};Common.App.OAuth.e=function(){};Common.App.OAuth.e.prototype={external:0,msa:1,aad:2};Common.App.OAuth.e.registerEnum("Common.App.OAuth.e",!0);Common.App.OAuth.g=function(){};Common.App.OAuth.f=function(n,t,i){this.k=n;this.d=i.a("OAuthManagerEnableConsoleLogging");this.f=i.a("IsO365ConsumerHost");this.e=i.a("IsO365CommercialHost");this.g=t;this.c=Common.App.OAuth.c.c();this.h=this.l(i.b("OAuthManagerHostPathOverride"));this.i=i.c("OAuthManagerPromiseTimeoutInMs",0);this.j=this.n(this.c)};Common.App.OAuth.f.b=function(){return Common.a.a.a("OAuthPreLoadMSALAppIDsIsEnabled")};Common.App.OAuth.f.prototype={k:null,d:!1,f:!1,e:!1,g:null,c:null,h:null,i:0,j:0,b:function(){if(!this.o())return Diag.a.a(592328355,3e3,50,"SSO-based OAuth is not supported for non-O365 hosts"),Promise.resolve(!1);var n=this;return $$sc.h.toPromise$o(this.g.b()).then(function(){return n.p()})},o:function(){return Common.a.a.b("FileSource")==="WopiTest"?!0:this.e||this.f},a:function(n,t,i,r,u,f){var e=r?0:this.i,o=new Common.App.OAuth.f.a(n,t,this.c.authorityType,i,r,u,e,this.j,f);return o.l()},p:function(){var r=Common.App.OAuth.c.b(),n,i=(n=new Common.ft,n.appIds=this.m(this.c.authorityType),n.idp=r,n.authority=this.c.authority,n.redirectUri=this.h,n.upn=this.c.upn,n.enableConsoleLogging=this.d,n),t;return this.c.authorityType===2&&(i.tenantId=this.c.tenantId),t=Common.App.OAuth.d.a.Load(i,Common.a.l),Diag.a.a(595342371,3e3,100,"WebAuthImplicitMsal package loaded."),t.Telemetry&&Diag.a.a(595342370,3e3,50,JSON.stringify(t.Telemetry)),Promise.resolve(!0)},l:function(n){var u=window.location.protocol,f=window.location.host,t=n,i,r;return isNullOrUndefined(t)&&(i=window.location.pathname,r=i.lastIndexOf("/"),t=r>=0?i.substring(0,r+1):""),u+"//"+f+t+"WacOAuth.html"},n:function(n){return n.upn.indexOf("guest#")>-1?2:n.upn.indexOf("ext#")>-1?1:0},m:function(n){var i=[],t,r,u,f;if(!Common.App.OAuth.f.b())return i;t={};n===2?t=Common.a.bx:n===1&&(t=Common.a.by);r=t;for(u in r)f={key:u,value:r[u]},Array.add(i,f.value);return i}};Common.App.OAuth.f.a=function(n,t,i,r,u,f,e,o,s){this.a=n;this.h=t;this.c=i;this.j=r;this.b=u;this.n=f;this.g=e;this.i=++Common.App.OAuth.f.a.a;this.k=o;this.f=s};Common.App.OAuth.f.a.prototype={a:null,h:null,f:null,c:0,j:null,g:0,i:0,b:!1,n:null,d:0,e:0,k:0,r:function(){if(this.b&&this.f){var n=this;return new Promise(function(t){var i=new CommonUI.d;i.g(1);i.h(1,$a.j);i.c($a.j,n.f,0,function(n){n!==2&&n||t(!0);t(!1)})})}return Promise.resolve(!1)},m:function(){return this.a==="OfficeAddins"},l:function(){var t,i=Common.g.a(),n=this;return this.r().then(function(r){if(r){var u;return Promise.resolve((u=new Common.cr,u.IsSuccess=!1,u.Token=null,u.ErrorCode="UserCancelled",u.ErrorMessage="User cancelled popup.",u))}return t=Common.App.OAuth.d.a.GetToken(n.j,n.h,Common.a.l,!1,n.b,n.m(),null).then(function(n){return n}),n.p(t).then(function(t){var i=n.o(t,!0);return i.IsSuccess?Diag.a.a(41460759,3e3,50,"Successfully retreived token for app [{0}]",n.a):Diag.a.a(41460760,3e3,15,"Failed to retrieve token for app [{0}]: {1}",n.a,JSON.stringify(i)),i},function(t){var i=n.o(t,!1);return(i.ErrorCode==="Timeout"||i.ErrorCode==="Token Renewal Failed"||i.ErrorCode==="token_renewal_error")&&n.d<2?(n.d+=1,Diag.a.a(42267907,3e3,100,"Retrying to retrieve token for app [{0}] attempt {1}: {2}",n.a,n.d,JSON.stringify(i)),n.l()):i.ErrorCode==="login_required"&&n.c===1&&n.e<=2&&Common.a.a.a("WordOAuthTestAppPopUpIsEnabled")?(n.e+=1,Diag.a.a(41460762,3e3,100,"Retrying retrieve token for app [{0}] with popup enabled, attempt {1}: {2}",n.a,n.e,JSON.stringify(i)),n.b=!0,n.l()):(Diag.a.a(41460764,3e3,15,"Failed to retrieve token for app [{0}]: {1}",n.a,JSON.stringify(i)),i)}).then(function(t){var r={};return r.IsSuccess=t.IsSuccess,r.TokenAquired=!!t.Token&&t.Token!=="",r.ErrorCode=t.ErrorCode,n.m()||(r.ErrorMessage=t.ErrorMessage),r.IsAnonymous=Common.a.a.a("IsAnonymousUser"),r.AuthLibrary="msal",r.TimeInMS=Common.g.a()-i,r.ReplyUrlHost=window.location.host,r.AppName=n.a,r.RequestNumber=n.i,r.AuthorityType=Common.App.OAuth.e.toString(n.c),r.UserType=n.k,r.IsAuthSupportedInSession=Common.App.OAuth.a.c(),Diag.a.a(593863640,3e3,50,JSON.stringify(r)),t})})},o:function(n,t){var i=n,e=null,r=null,u=null,o=null,f;return i?i.ErrorCode||i.ErrorMessage?(r=i.ErrorCode?i.ErrorCode:"Exception",u=i.ErrorMessage?i.ErrorMessage:"No message"):i.Token?t?e=i.Token:(r="RejectToken",u="A rejected promise returned a token."):(r="Exception",u=JSON.stringify(n)):(r="NoResult",u="No result came from WebAuthJsImplictModule.GetToken()"),i&&i.Telemetry&&!this.m()&&(o=i.Telemetry,Diag.a.a(595150290,3e3,50,JSON.stringify(o))),r==="token_renewal_error"&&(u="Token Renewal Error"),(r||u)&&(e=null),f=new Common.cr,f.IsSuccess=!!e,f.Token=e,f.ErrorCode=r,f.ErrorMessage=u,f.Telemetry=o,f},p:function(n){if(this.g<=0)return n;var t=0,i=this,r=this;return Promise.race([n,new Promise(function(n){t=window.setTimeout(function(){n(i.q())},i.g)})]).then(function(n){return window.clearTimeout(t),n})},q:function(){var n=new Common.gV;return n.ErrorCode="Timeout",n.ErrorMessage="The Implicit package did not resolve the promise",n}};Common.App.OAuth.c=function(){};Common.App.OAuth.c.c=function(){var n;return n=new Common.App.OAuth.g,n.upn=Common.a.a.b("UserPrincipalName"),n.authority="https://login.microsoftonline.com/",n.authorityType=Common.App.OAuth.c.a(),n.tenantId=Common.a.a.b("TenantId"),n};Common.App.OAuth.c.a=function(){var n=0,t=Common.App.OAuth.c.b();return t.toLowerCase()==="aad"?n=2:t.toLowerCase()==="msa"&&(n=1),n};Common.App.OAuth.c.b=function(){return Common.a.a.b("HostAuthType")};Common.App.OAuth.a=function(n,t){this.g=new Common.App.OAuth.k(n);this.e=t;Diag.a.a(42084323,3e3,100,"OAuthManager Created")};Common.App.OAuth.a.c=function(){return Common.App.OAuth.a.b||Common.App.OAuth.a.e(),Common.App.OAuth.a.a};Common.App.OAuth.a.f=function(){return Common.a.a.a("UiHostSupportsAuthToken")};Common.App.OAuth.a.e=function(){if(Common.a.a.b("FileSource")==="WopiTest")return Common.App.OAuth.a.a=!0,Common.App.OAuth.a.b=!0,Common.App.OAuth.a.a;var n=Common.a.a.a("IsAnonymousUser"),t=Common.a.a.a("IsO365ConsumerHost")||Common.a.a.a("IsO365CommercialHost");return Common.App.OAuth.a.a=!n&&t&&Common.App.OAuth.a.d(),Common.App.OAuth.a.b=!0,Common.App.OAuth.a.a};Common.App.OAuth.a.d=function(){var n=new Array(0);return Common.a.a.e("OAuthManagerDisabledBrowsers")&&(n=Common.a.a.f("OAuthManagerDisabledBrowsers"),n&&Common.c.r()&&Array.contains(n,"Electron"))?!1:!0};Common.App.OAuth.a.prototype={g:null,e:null,f:null,h:!1,c:function(n){var t,i,r;if(Common.a.a.a("SideCarIsEnabled")){if(this.h){Diag.a.a(594057428,3e3,50,"Sidecar Auth Config already loaded");return}t=this;Common.bX.b().then(function(n){var u;if(n){var r=Common.App.OAuth.c.c(),e=Common.App.OAuth.c.b(),i,f=(i=new Common.ft,i.appIds=new Array(0),i.idp=e,i.authority=r.authority,i.redirectUri=t.j(Common.a.a.b("OAuthManagerHostPathOverride")),i.upn=r.upn,i.enableConsoleLogging=Common.a.a.a("OAuthManagerEnableConsoleLogging"),i);r.authorityType===2&&(f.tenantId=r.tenantId);u=sidecar.oAuth.Load(f,null);u.Telemetry&&(Diag.a.a(594057427,3e3,50,"Loaded Sidecar Auth: "+JSON.stringify(u.Telemetry)),t.h=!0)}else Diag.a.a(594057426,3e3,50,"Failed to load Sidecar");return null})}this.e||(this.e=new Common.App.OAuth.f(n,this.g,Common.a.a));this.f||(i=this,r=this,this.f=this.e.b().then(function(){return Diag.a.a(42084353,3e3,100,"OAuthManager initialized for app [{0}]",n),!0},function(){return Diag.a.a(42267908,3e3,10,"OAuthManager failed to initialized for app [{0}], all future TryGetToken requests will fail.",n),!1}))},j:function(n){var u=window.location.protocol,f=window.location.host,t=n,i,r;return isNullOrUndefined(t)&&(i=window.location.pathname,r=i.lastIndexOf("/"),t=r>=0?i.substring(0,r+1):""),u+"//"+f+t+"WacOAuth.html"},a:function(n,t){return this.i(n,t,!1,null,"")},b:function(n,t,i,r){return this.i(n,t,!0,i,r)},i:function(n,t,i,r,u){var e,o,h,f,s,y,c;if(Diag.a.a(42084352,3e3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called",n,t),!Common.a.a.a("OAuthManagerIsEnabled"))return Promise.resolve((e=new Common.cr,e.IsSuccess=!1,e.Token=null,e.ErrorCode="NotEnabled",e.ErrorMessage="OAuthManager is disabled.",e));if(!Common.App.OAuth.a.d())return Promise.resolve((o=new Common.cr,o.IsSuccess=!1,o.Token=null,o.ErrorCode="NotEnabled",o.ErrorMessage="OAuthManager is disabled on Electron to avoid Popups",o));if(h=Common.App.OAuth.c.a(),f=null,h===2?f=Common.a.bx[n]:h===1&&(f=Common.a.by[n]),isNullOrUndefined(f))return Diag.a.a(41961345,3e3,15,"Auth context not found. Ensure that your app [{0}] is listed in WacFrameImplicitAuthAADApplications or WacFrameImplicitAuthMSAV2Applications.",n),Promise.resolve((s=new Common.cr,s.IsSuccess=!1,s.Token=null,s.ErrorCode="DisallowedApp",s.ErrorMessage="Disallowed appName: "+n,s));if(Common.App.OAuth.a.f()){Diag.a.a(589662423,3e3,50,"Single sign on based on tokens");var l=Common.Utils.a.a().a(Common.App.WopiIdentity.d,null),a=this.k(t),v=new Common.App.WopiIdentity.f(t,a,!i,null,Common.a.l),p=this,w=this,b=this;return l.getAccessToken(v,f).then(function(n){var t;return t=new Common.cr,t.IsSuccess=!0,t.Token=n.get_accessToken(),t},function(n){var t;return t=new Common.cr,t.IsSuccess=!1,t.ErrorCode=n,t}).then(function(t){var i={};return i.IsSuccess=t.IsSuccess,i.TokenAquired=!!t.Token&&t.Token!=="",i.ErrorCode=t.ErrorCode,i.AppName=n,i.AppId=f,Diag.a.a(589662424,3e3,50,JSON.stringify(i)),t})}return this.c(f),Common.a.a.a("SideCarIsEnabled")?(y=this,Common.bX.b().then(function(){return sidecar.oAuth.GetToken(n,t,0).then(function(n){var t;return t=new Common.cr,t.IsSuccess=n.IsSuccess,t.Token=n.Token,t.ErrorCode=n.ErrorCode,t.ErrorMessage=n.ErrorMessage,t})})):(c=this,this.f.then(function(e){if(e)return c.e.a(n,f,t,i,r,u);var o;return Promise.resolve((o=new Common.cr,o.IsSuccess=!1,o.Token=null,o.ErrorCode="InitFailed",o.ErrorMessage="Package failed to initialize.",o))}))},k:function(n){for(var u,i=!1,r=["HTTPS:","API:"],f=r.length,t=0;t<f;++t)u=r[t],n.toLocaleUpperCase().startsWith(u)&&(i=!0);return i||this.l(n)?n+"/.default":n},l:function(n){var t=new RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i");return t.test(n)},d:function(){return Common.App.OAuth.a.c()}};Common.App.OAuth.j=function(){};Common.App.OAuth.j.a=function(){Common.App.a.a().a(new Common.App.OAuth.j,0,!1)};Common.App.OAuth.j.prototype={a:function(){return"Common.App.OAuth.OAuthPackage"},c:function(n){var t=this;n.b(Common.App.OAuth.b,null).a().b(function(){return new Common.App.OAuth.a(n.a(Common.fy,null),null)})},b:function(){Common.Utils.a.a().a(Common.App.OAuth.b,null).c(null)}};Common.App.OAuth.d=function(){};Common.App.OAuth.k=function(n){this.a=n};Common.App.OAuth.k.prototype={a:null,b:function(){var n=Common.a.bI("webauth.implicit.msal",2),t=Common.a.bI("es6-promise.auto",2),i;return window.self.WebAuthImplictScriptUrl=n,window.self.Es6PromisePolyfillJs=t,i=this,this.a.a(n).CW(function(){var n=window.self.Implicit;Common.App.OAuth.d.a=n;Diag.a.a(41003229,3e3,100,"WebAuth package loaded")})}};Common.App.OAuth.f.a.a=0;Common.App.OAuth.a.b=!1;Common.App.OAuth.a.a=!1;Common.App.OAuth.d.a=null;Common.App.OAuth.j.a();Type.registerNamespace("Common.App.OAuth");Common.App.OAuth.h=function(){};Common.App.OAuth.h.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthCommercialTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.i(function(){var o=n.d.a(Common.App.OAuth.b,null),s=Common.a.a.b("LokiAADAppId"),h=Common.a.a.a("OAuthTestAppAllV2TokenRetrievalIsEnabled"),c=Common.a.bx,r=c,t,e;for(t in r){var i={key:t,value:r[t]},u=i.key==="Loki",f=u?s:"openid";(h||u)&&(Diag.a.a(42084354,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}",i.key,f),e=Common.g.a(),o.a(i.key,f).then(function(n){var t={};t.IsSuccess=n.IsSuccess;t.TokenAquired=!!n.Token&&n.Token!=="";t.ErrorCode=n.ErrorCode;t.ErrorMessage=n.ErrorMessage;t.IsAnonymous=Common.a.a.a("IsAnonymousUser");t.IsMSAL=!0;t.TimeInMS=Common.g.a()-e;t.ReplyUrlHost=window.location.host;Diag.a.a(41964885,3e3,50,JSON.stringify(t))}).catch(function(n){Diag.a.a(42084355,3e3,15,JSON.stringify(n))}))}})}}};Common.App.OAuth.i=function(){};Common.App.OAuth.i.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthConsumerTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.i(function(){var o=n.d.a(Common.App.OAuth.b,null),s=Common.a.a.b("LokiMSAAppId"),h=Common.a.a.a("OAuthTestAppAllV2TokenRetrievalIsEnabled"),c=Common.a.by,r=c,t,e;for(t in r){var i={key:t,value:r[t]},u=i.key==="Loki",f=u?s:"openid";(h||u)&&(Diag.a.a(50431968,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}",i.key,f),e=Common.g.a(),o.a(i.key,f).then(function(n){var t={};t.IsSuccess=n.IsSuccess;t.TokenAquired=!!n.Token&&n.Token!=="";t.ErrorCode=n.ErrorCode;t.ErrorMessage=n.ErrorMessage;t.IsAnonymous=Common.a.a.a("IsAnonymousUser");t.IsMSAL=!0;t.TimeInMS=Common.g.a()-e;t.ReplyUrlHost=window.location.host;Diag.a.a(50431969,3e3,50,JSON.stringify(t))}).catch(function(n){Diag.a.a(50431970,3e3,15,JSON.stringify(n))}))}})}}};Common.App.OAuth.n=function(){};Common.App.OAuth.n.a=function(){Common.a.a.a("OAuthTestAppIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.l,0,!1);Common.a.a.a("OAuthTestAppAadTokenRetrievalIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.h,0,!1);Common.a.a.a("OAuthTestAppMsaTokenRetrievalIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.i,0,!1)};Common.App.OAuth.l=function(){};Common.App.OAuth.l.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.i(function(){var u=n.d.a(Common.App.OAuth.b,null),t=Common.a.dm,i=t.AppName,e=t.AuthorityType,f=t.TokenTarget,r;Diag.a.a(42084356,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}",i,JSON.stringify(t));r=Common.g.a();u.a(i,f).then(function(n){var t={};t.IsSuccess=n.IsSuccess;t.TokenAquired=!!n.Token&&n.Token!=="";t.ErrorCode=n.ErrorCode;t.ErrorMessage=n.ErrorMessage;t.TimeInMS=Common.g.a()-r;Diag.a.a(41460766,3e3,50,JSON.stringify(t))}).catch(function(n){Diag.a.a(42084357,3e3,15,JSON.stringify(n))})})}}};Common.App.OAuth.n.a();Type.registerNamespace("Common.App.LivePersonaUtils");Common.App.LivePersonaUtils.b=function(){};Common.App.LivePersonaUtils.b.a=function(){Common.App.a.a().a(new Common.App.LivePersonaUtils.b,0,!1)};Common.App.LivePersonaUtils.b.prototype={a:function(){return"Common.App.LivePersonaUtils"},b:function(){Common.Utils.a.a().a(Common.dS,null)},c:function(n){var t=this;n.b(Common.App.LivePersonaUtils.a,null).c(Common.dS,null).a().b(function(){return new Common.App.LivePersonaUtils.a(Common.Utils.b.a(Common.App.OAuth.b,n.c(Common.App.OAuth.b,null)))})}};Common.App.LivePersonaUtils.a=function(n){this.b=n};Common.App.LivePersonaUtils.a.prototype={b:null,a:function(){var i=this.c(),n,t;return i?(t=this,new Promise(function(n,r){t.b.CW(function(){if(t.b.b===4||t.b.b===5){r(Error.create("Error downloading auth library"));return}t.b.a().a("Loki",i).then(function(t){var u,i,r;return u=t.IsSuccess&&t.Token?(i=new Common.eA,i.isSuccess=!0,i.token=t.Token,i.errorMessage=null,i):(r=new Common.eA,r.isSuccess=!1,r.token=null,r.errorMessage=JSON.stringify(t),r),n(u),u})})})):Promise.resolve((n=new Common.eA,n.isSuccess=!1,n.token=null,n.errorMessage=String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",Common.App.OAuth.c.b()),n))},c:function(){var n=null,t=Common.App.OAuth.c.a();return t===2?n=Common.a.a.b("LokiAADAppId"):t===1&&(n=Common.a.a.b("LokiMSAAppId")),n}};Common.App.LivePersonaUtils.a.registerClass("Common.App.LivePersonaUtils.a",null,Common.dS);Common.App.LivePersonaUtils.b.a();Type.registerNamespace("_Ewa");_Ewa.xu=function(n){_Ewa.xu.initializeBase(this);this.a=n;this.e()};_Ewa.xu.a=function(n){n.b().b(_Ewa.wC.$$(_Ewa.hY),350,new _Ewa.xu(n))};_Ewa.xu.prototype={a:null,p:function(){this.d(this.a.b().a(_Ewa.hY,349,!1,null)||new _Ewa.OAuthManagerWrapper(Common.Utils.a.a().a(Common.App.OAuth.b,null)))}};_Ewa.OAuthManagerWrapper=function(n){this.c=n};_Ewa.OAuthManagerWrapper.prototype={c:null,b:function(n,t){var i,r;return this.c?(r=this,this.c.a(n,t).then(function(t){t.IsSuccess||Diag.a.a(51401292,0,15,"Error retrieving auth token. Message: "+t.ErrorMessage+" Error code: "+t.ErrorCode+" App name: "+n);var i;return i=new _Ewa.km,i.IsSuccess=t.IsSuccess,i.Token=t.Token,i.ErrorCode=t.ErrorCode,i.ErrorMessage=t.ErrorMessage,i})):(Diag.a.a(51401291,0,10,"Oauth manager is null"),Promise.resolve((i=new _Ewa.km,i.IsSuccess=!1,i.Token=null,i.ErrorCode="FailedToResolve",i.ErrorMessage="Failed to resolve IOAuthManager from the container.",i)))},a:function(){return this.c?this.c.d():null}};_Ewa.xu.registerClass("_Ewa.xu",_Ewa.qU.$$(_Ewa.hY));_Ewa.OAuthManagerWrapper.registerClass("_Ewa.OAuthManagerWrapper",null,_Ewa.hY);Type.registerNamespace("_Ewa");_Ewa.bgk=function(){};_Ewa.bgk.a=function(){_Ewa.k.a(function(n){_Ewa.xu.a(n)})};_Ewa.bgk.a();